@page
@model VolumeSearchModel
@{
    
    ViewData["Title"] = "Volume Search (поиск кластеров FootPrint по заданным параметрам)";
}
<script src="~/Scripts/controls.js" type="text/javascript"></script>

@if (false)
{
    <h1>Функция доступна по платной подписке</h1>
    <p>Для оплаты залогинтесь и оплатите по ссылке в меню <a href="Payment">Услуги->Премиум доступ</a></p>
    <img src="/images/Vs.png">
}
else
{
    
<div class="widerightsidebar">
    <div class="blogblock">
<div id="example">
    <h6>@ViewBag.Title</h6>
    <fieldset class="k-block" style="width:100%">
        <legend>Параметры</legend>
        <ul id="fieldlist">
            <li><label for="ticker">Тикер</label> <input id="ticker" data-bind="value: controls.ticker, events: { change: changeticker }" class="k-textbox" /></li>
            <li>
                <label for="period">Период</label>
                <select style="width: 90px"
                        data-role="dropdownlist"
                        data-value-field="Value"
                        data-text-field="Text"
                        data-value-primitive="true"
                        data-bind="value: controls.period, source: periodlist"></select>
            </li>
            <li>
                <label for="startTime">Шаг цен</label>
                <input id="ps"
                       data-min="0"
                       data-format="n4"
                       data-decimals="4"
                       data-step="0.0001"
                       data-role="numerictextbox"
                       data-bind="value: controls.priceStep" style="width: 80px" />
            </li>
            <li>
                <label for="rperiod">Промежуток</label>
                <select style="width: 140px"
                        data-role="dropdownlist"
                        data-value-field="Value"
                        data-text-field="Text"
                        data-value-primitive="true"
                        data-bind="value: controls.rperiod, source: rperiodlist, events: { change: changerperiod }"></select>
            </li>
            <li>
                <label for="startDate">Начальная дата</label>
                <input style="width: 100px" data-format="dd.MM.yyyy" data-role="datepicker" data-bind="value: controls.startDate , events: { change: changedate }" class="editor-field" />
            </li>
            <li>
                <label for="endDate">Конечная дата</label>
                <input style="width: 100px" data-format="dd.MM.yyyy" data-role="datepicker" data-bind="value: controls.endDate , events: { change: changedate }" class="editor-field" />
            </li>
            <li data-bind="visible: controls.timeEnable">
                <label for="startTime">Нач. время</label>
                <input style="width: 75px" data-format="HH:mm" data-min="9:30" data-role="timepicker" data-bind="value: controls.startTime , events: { change: changetime}" class="editor-field" />
            </li>
            <li data-bind="visible: controls.timeEnable">
                <label for="endTime">Кон. время</label>
                <input style="width: 75px" data-format="HH:mm" data-min="10:00" data-role="timepicker" data-bind="value: controls.endTime , events: { change: changetime }" class="editor-field" />
            </li>
            <li>
                <div data-bind="visible: timeVisible">
                    <input type="checkbox" id="TimeEnable" class="k-checkbox" data-bind="checked: controls.timeEnable">
                    <label class="k-checkbox-label" for="TimeEnable">Время</label>
                </div>
            </li>
            <li><label for="but"> <br /> </label> <button id="but" data-bind="click: apply" class="k-button k-primary">Показать</button></li>     
        </ul>
    </fieldset>
        <div id="grid"> </div>
</div>
<div id="settings">
</div>
</div>
</div>
}
<script>
    @{<text>var preset = </text>@Html.Raw(Model.preset)<text>;</text>}
    $(document).ready(function () {
        ApplyTicker = function()
        {
            ReportVolumeSearch();
        }
        viewModel = CreateViewModel(preset, ApplyTicker);       
        ApplyTicker();


            $("#ticker").autocomplete({
        source: function(request, response) {
            $.get(
                '/api/common/findbymask', {
                    mask: request.term
                },
                function(data) {
                    response(data);
                });
        },
        select: function(event, ui) {
            MouseAutoComplete('ticker', event, ui);
            viewModel.set("controls.ticker", document.getElementById("ticker").value);
            UpdateControls(viewModel, ControlsToParamsTicker(viewModel.controls), ApplyTicker);
            return false;
        },
        minLength: 1
    });

       
    });
</script>
