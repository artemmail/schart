<mat-card class="table-card">
    <mat-card-header>
      <mat-card-title>Оплатившие пользователи</mat-card-title>
    </mat-card-header>
  
    <mat-card-content>
      <table
        mat-table
        [dataSource]="dataSource"
        multiTemplateDataRows
        class="custom-table"
        matSort
      >
        <!-- Expand Column -->
        <ng-container matColumnDef="expand">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let element">
            <mat-icon
              class="expand-icon"
              [attr.aria-label]="expandedElement === element ? 'collapse' : 'expand'"
              (click)="toggleRow(element); $event.stopPropagation();"
            >
              {{ expandedElement === element ? 'expand_less' : 'expand_more' }}
            </mat-icon>
          </td>
        </ng-container>
  
        <!-- Username Column -->
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Пользователь</th>
          <td mat-cell *matCellDef="let element">{{ element.username }}</td>
        </ng-container>
  
        <!-- Email Column -->
        <ng-container matColumnDef="Email">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
          <td mat-cell *matCellDef="let element">{{ element.Email }}</td>
        </ng-container>
  
        <!-- Total Column -->
        <ng-container matColumnDef="total">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Оплачено</th>
          <td mat-cell *matCellDef="let element">
            {{ element.total | currency: 'RUB':'symbol' }}
          </td>
        </ng-container>
  
        <!-- Count Column -->
        <ng-container matColumnDef="cnt">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Количество</th>
          <td mat-cell *matCellDef="let element">{{ element.cnt }}</td>
        </ng-container>
  
        <!-- Max Column -->
        <ng-container matColumnDef="max">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Максимум</th>
          <td mat-cell *matCellDef="let element">
            {{ element.max | currency: 'RUB':'symbol' }}
          </td>
        </ng-container>
  
        <!-- Min Column -->
        <ng-container matColumnDef="min">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Минимум</th>
          <td mat-cell *matCellDef="let element">
            {{ element.min | currency: 'RUB':'symbol' }}
          </td>
        </ng-container>
  
        <!-- Last Date Column -->
        <ng-container matColumnDef="lastdate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Последний заход</th>
          <td mat-cell *matCellDef="let element">
            {{ element.lastdate | date: 'short' }}
          </td>
        </ng-container>
  
        <!-- Expiration Date Column -->
        <ng-container matColumnDef="expdate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Дата истечения</th>
          <td mat-cell *matCellDef="let element">
            {{ element.expdate | date: 'short' }}
          </td>
        </ng-container>
  
        <!-- Expanded Detail Row -->
        <ng-container matColumnDef="expandedDetail">
          <td
            mat-cell
            *matCellDef="let element"
            [attr.colspan]="displayedColumns.length"
          >
            <div
              class="element-detail"
              [@detailExpand]="expandedElement === element ? 'expanded' : 'collapsed'"
            >
              <div *ngIf="expandedElement === element">
                <mat-spinner *ngIf="!element.totalPays"></mat-spinner>
                <table
                  mat-table
                  [dataSource]="element.totalPays"
                  *ngIf="element.totalPays"
                  class="inner-table"
                >
                  <!-- PayDate Column -->
                  <ng-container matColumnDef="PayDate">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                      Дата платежа
                    </th>
                    <td mat-cell *matCellDef="let pay">
                      {{ pay.PayDate | date: 'short' }}
                    </td>
                  </ng-container>
  
                  <!-- PayAmount Column -->
                  <ng-container matColumnDef="PayAmount">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Сумма</th>
                    <td mat-cell *matCellDef="let pay">
                      {{ pay.PayAmount | currency: 'RUB':'symbol' }}
                    </td>
                  </ng-container>
  
                  <!-- Inner Table Header Row -->
                  <tr
                    mat-header-row
                    *matHeaderRowDef="['PayDate', 'PayAmount']"
                  ></tr>
  
                  <!-- Inner Table Data Row -->
                  <tr
                    mat-row
                    *matRowDef="let pay; columns: ['PayDate', 'PayAmount']"
                  ></tr>
                </table>
              </div>
            </div>
          </td>
        </ng-container>
  
        <!-- Header Row Definition -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  
        <!-- Data Row Definition -->
        <tr mat-row *matRowDef="let element; columns: displayedColumns" class="element-row"></tr>
  
        <!-- Expanded Detail Row Definition -->
        <tr
          mat-row
          *matRowDef="let element; columns: ['expandedDetail']"
          class="detail-row"
        ></tr>
      </table>
    </mat-card-content>
  </mat-card>
  